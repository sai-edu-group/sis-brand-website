---
export const prerender = false; // Render on Server

// LAYOUT //
import Layout from "@/layouts/Layout.astro";

// COMPONENTS //
import FilterBar from "@/components/FilterBar.astro";
import SectionHeaderMain from "@/components/SectionHeaderMain.astro";
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import ResultsCard from "@/components/ResultsCard.astro";

// DATA //
import { cbseClasses } from "@/data/results/cbse-12th";
import { URLS } from "@/infrastructure/constants/urls";

/** Get the static Path's */
export async function getStaticPaths() {
  return cbseClasses.map((cbseClass) => ({
    params: { streamId: cbseClass.id.toString() },
    props: cbseClass,
  }));
}

// Page Props
const { id, name, years } = Astro.props;

// Breadcrumb Items
const breadcrumbItems = [
  { label: "12th Results", href: URLS.RESULTS.CBSE_12.ROOT },
  { label: name, href: URLS.RESULTS.CBSE_12.STREAM(id.toString()) },
];

// Get the Year
const year = Astro.url.searchParams.get("year") || years[0];

// Get the Results (TODO: Will be API Call)
const results =
  cbseClasses.find((cbseClass) => cbseClass.id === id)?.results[year] || [];
---

<Layout>
  <div class="container">
    <!-- Breadcrumbs -->
    <div class="bg-n-50 relative w-full overflow-hidden">
      <div
        class="container mx-auto px-6 pt-30 pb-5 md:pt-40 md:pb-8 lg:pb-9 2xl:px-0"
      >
        <Breadcrumbs items={breadcrumbItems} />
      </div>
    </div>

    <!-- Section Header -->
    <SectionHeaderMain
      title={name}
      subtitle="Celebrating our students hard work and achievements"
    />

    <section class="bg-n-50 relative w-full overflow-hidden">
      <div
        class="container mx-auto flex flex-col gap-10 px-6 md:gap-14 lg:gap-9 2xl:px-0"
      >
        <div class="flex flex-col gap-8 md:gap-12">
          <div class="flex flex-col gap-7 md:gap-8">
            <!-- Years Filters -->
            <FilterBar showSearch={false} years={years} />

            <!-- Results -->
            <div
              class="grid grid-cols-1 gap-5 md:grid-cols-2 md:gap-6 lg:grid-cols-3 2xl:grid-cols-4 2xl:gap-8"
            >
              {
                results.map((resultItem) => (
                  <ResultsCard
                    studentName={resultItem.studname}
                    score={resultItem.percentage}
                    image={resultItem.studprofilepic}
                  />
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</Layout>
