---
// COMPONENTS //
import Input from "@/components/ui/Input.astro";
import StepCard from "@/components/ui/FormStepsCard.astro";
import Select from "@/components/ui/Select.astro";
import Textarea from "@/components/ui/Textarea.astro";
import Button from "@/components/ui/Button.astro";
import SectionHeader from "@/components/ui/SectionHeader.astro";
import Image from "astro/components/Image.astro";

// DATA //
import { grades } from "@/data/admissions/form";

const STEP_TITLES = ["About Student", "About Parent", "Boarding Preference"];
---

<section
  id="admission-section"
  class="bg-n-100 mx-auto w-full space-y-6"
  data-section="Admission Form"
>
  <div
    class="container mx-auto flex flex-col gap-16 px-6 py-12 md:py-24 lg:px-8 2xl:px-6"
  >
    <!-- Section Header -->
    <SectionHeader
      title="Now what are you waiting for? Let‚Äôs Begin Your SAI Journey"
      subtitle="A few details from you, and we‚Äôll be in touch with care, clarity, and guidance."
    />

    <!-- ONE form for all steps -->
    <form id="admission-form">
      <!-- STEP 1 -->

      <StepCard id="step-1" step={1} total={3} title={STEP_TITLES[0]}>
        <div class="flex flex-col gap-14 md:gap-24">
          <div
            class="grid grid-cols-1 gap-x-20 gap-y-6 sm:grid-cols-2 md:gap-y-9"
          >
            <!-- Student Name Input -->
            <div data-field>
              <Input
                label="Student‚Äôs First Name"
                name="firstName"
                required
                placeholder="Enter Student's First Name"
                errorMessage="Student's First name is required and should not contain numbers.."
              />
            </div>

            <!-- Student Name Input -->
            <div data-field>
              <Input
                label="Student‚Äôs Last Name"
                name="lastName"
                required
                placeholder="Enter Student's Last Name"
                errorMessage="Student's Last name is required and should not contain numbers.."
              />
            </div>

            <!-- DOB Input -->
            <div data-field>
              <Input
                label="Student‚Äôs Date of Birth"
                name="dob"
                type="date"
                required
                errorMessage="Date of birth is required."
              />
            </div>

            <!-- Class Select -->
            <Select
              label="Select Class"
              name="className"
              required
              placeholder="Select Class"
              options={grades}
              errorMessage="Please select the class for admission."
            />

            <!-- Current School Input -->
            <div data-field>
              <Input
                label="Current School"
                name="currentSchool"
                required
                errorMessage="Current school is required."
              />
            </div>

            <!-- City Input -->
            <div data-field>
              <Input
                label="City"
                name="city"
                required
                placeholder="Enter City"
                errorMessage="City is required and should not contain numbers."
              />
            </div>

            <div class="flex flex-wrap items-end justify-between gap-8">
              <p class="text-n-500 text-base font-normal md:text-xl">
                We welcome learners from all backgrounds and cities.
              </p>
              <!-- Button: Continue to next step -->
              <Button
                id="next-1"
                type="button"
                text="Continue to Parent Info"
                variant="solid"
                size="medium"
              />
            </div>
          </div>
        </div>
      </StepCard>

      <!-- STEP 2 -->
      <StepCard
        id="step-2"
        step={2}
        total={3}
        title={STEP_TITLES[1]}
        class={"hidden"}
      >
        <div class="flex flex-col gap-14 md:gap-24">
          <div
            class="grid grid-cols-1 gap-x-20 gap-y-6 sm:grid-cols-2 md:gap-y-9"
          >
            <!-- Parent/Guardian Input -->
            <div data-field>
              <Input
                label="Parent / Guardian‚Äôs Full Name"
                name="parentName"
                required
                errorMessage="Parent/Guardian name is required and should not contain numbers..."
              />
            </div>

            <!-- Phone Input -->
            <div data-field>
              <Input
                label="Phone Number"
                name="mobileNo"
                type="tel"
                required
                errorMessage="Enter a valid 10-digit number."
              />
            </div>

            <!-- Email Input -->
            <div data-field>
              <Input
                label="Email ID"
                name="emailId"
                type="email"
                required
                errorMessage="Enter a valid email address."
              />
            </div>
          </div>

          <div class="flex flex-wrap items-center justify-between gap-8">
            <p
              class="text-n-500 text-base font-medium md:text-xl xl:flex xl:flex-1"
            >
              This is how we‚Äôll get in touch with you. We don‚Äôt spam, promise.
            </p>
            <div class="flex flex-wrap gap-3">
              <!-- Back button -->
              <Button
                id="back-2"
                type="button"
                text="Back to Child Details"
                variant="ghost"
                size="medium"
                extraClasses="border border-n-300 bg-white text-n-800 hover:bg-n-100"
              />
              <!-- Continue button -->
              <Button
                id="next-2"
                type="submit"
                text="Continue to Preferences"
                variant="solid"
                size="medium"
              />
            </div>
          </div>
        </div>
      </StepCard>

      <!-- STEP 3 -->
      <StepCard
        id="step-3"
        step={3}
        total={3}
        title={STEP_TITLES[2]}
        class={"hidden"}
      >
        <!-- Fields wrapper -->
        <div class="flex flex-col gap-14 md:gap-24">
          <div
            class="grid grid-cols-1 gap-x-20 gap-y-6 sm:grid-cols-2 md:gap-y-9"
          >
            <!-- Hotel Required Select -->
            <Select
              label="Hostel Required"
              name="hostel"
              placeholder="Select"
              required
              options={[
                { label: "Yes", value: "Yes" },
                { label: "No", value: "No" },
              ]}
              errorMessage="Please select an option."
            />

            <!-- Message textarea -->
            <Textarea
              label="Message"
              name="message"
              placeholder="Any specific concerns, requests, or child interests?"
              errorMessage="Message is required."
              required
              rows={2}
            />
          </div>

          <div class="flex flex-wrap items-center justify-between gap-8">
            <p
              class="text-n-500 flex text-base font-medium md:text-xl xl:flex-1"
            >
              Let us know if you‚Äôd like your child to avail hostel facilities.
              This helps us guide you better.
            </p>
            <div class="flex flex-wrap gap-3">
              <!-- Back button -->
              <Button
                id="back-3"
                type="button"
                text="Back to Parent Info"
                variant="ghost"
                size="medium"
                extraClasses="border border-n-300 bg-n-50 text-n-800 hover:bg-n-100"
              />
              <!-- Submit button -->
              <Button
                id="submit"
                type="submit"
                text="Submit Inquiry"
                variant="solid"
                size="medium"
                extraClasses="bg-[#C9443A]/80 hover:bg-orange-500 text-n-50"
              />
            </div>
          </div>
        </div>
      </StepCard>

      <!-- THANK YOU -->
      <article
        id="thank-you"
        class="border-n-200 slide-parent stagger bg-n-50 flex flex-col items-center gap-8 rounded-3xl border px-6 py-8 text-center md:gap-10 md:py-12 lg:gap-12 lg:py-24"
      >
        <!-- Paper plan icon -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="231"
          height="134"
          viewBox="0 0 231 134"
          fill="none"
          class="floating-icon h-12 -rotate-10 md:h-24 lg:h-32"
        >
          <path
            d="M103.562 73.5863C98.0365 72.1321 78.2597 58.4628 62.5545 73.5863C46.8494 88.7098 19.22 121.865 4.969 114.012"
            class="draw-svg"
            stroke="#CC554D"
            stroke-width="8"
            stroke-linecap="round"
            stroke-dasharray="28 28"></path>
          <path
            d="M213.215 37.2109C214.625 37.802 217.655 39.4954 218.671 40.2592C221.586 42.4497 223.357 44.903 224.311 48.0697C224.742 49.4981 224.973 51.2576 224.909 52.6175C224.617 58.8535 220.359 65.5009 210.33 75.383C204.12 81.5018 194.206 90.0236 182.688 99.1443C173.467 106.446 167.223 110.275 161.741 111.99C155.579 113.918 150.089 113.411 144.906 110.437C141.195 108.308 138.508 105.73 135.51 101.424L134.579 100.087L132.967 100.485C129.206 101.415 128.524 101.559 127.449 101.659C125.559 101.835 123.659 101.497 121.805 100.658C117.214 98.5787 114.504 93.5806 115.276 88.6189C115.53 86.991 115.796 86.4065 119.414 79.5347L122.763 73.178L122.329 71.4377C121.021 66.1745 120.374 62.5503 119.898 57.8161C119.187 50.736 119.5 45.9112 120.943 41.7341C121.436 40.307 123.01 37.2474 123.776 36.2266C127.531 31.2241 132.887 28.5636 140.901 27.721C147.429 27.0346 154.975 27.3991 172.413 29.2418C192.332 31.3467 205.245 33.8687 213.215 37.2109ZM212.267 45.26C211.219 44.6875 209.983 44.0705 209.519 43.8879C201.038 40.5484 185.795 37.9865 161.251 35.7767C155.737 35.2801 153.214 35.12 149.67 35.0421C143.22 34.9002 139.635 35.2641 136.141 36.4138C133.389 37.3195 131.7 38.4619 130.087 40.5086C129.237 41.5871 128.172 43.8087 127.774 45.3334C126.878 48.7691 126.905 54.0117 127.855 60.5114C128.137 62.4468 128.775 65.8418 128.865 65.8888C128.9 65.9052 129.442 65.7561 130.071 65.5561C130.701 65.3555 133.441 64.5477 136.159 63.7619C149.834 59.8078 164.076 56.2685 178.09 53.3412C184.698 51.9609 192.046 50.5819 192.7 50.5993C193.268 50.6144 193.46 50.6751 194.239 51.0852C195.022 51.4981 195.176 51.6181 195.523 52.094C196.578 53.5425 196.497 55.5789 195.334 56.8641C194.482 57.8057 194.269 57.8767 189.586 58.7825C169.991 62.5727 154.272 66.3866 134.603 72.1222L130.607 73.2866L130.604 73.6583C130.598 74.5164 130.546 74.6289 126.632 82.1829C122.772 89.6335 122.76 89.6574 122.731 90.211C122.691 90.9825 123.068 92.0719 123.587 92.6837C123.921 93.0775 124.194 93.2804 124.855 93.63C126.15 94.3138 126.299 94.3013 131.226 93.0872C133.559 92.5123 135.701 92.0157 135.986 91.984C137.002 91.871 138.257 92.3133 138.998 93.0441C139.19 93.2327 139.711 93.971 140.157 94.6853C141.907 97.4877 143.749 99.8705 145.374 101.436C147.246 103.241 150.016 104.776 152.293 105.273C154.623 105.781 156.459 105.638 159.409 104.718C164.771 103.046 170.397 99.3606 182.249 89.7598C197.501 77.4042 206.555 69.0923 211.985 62.4603C214.011 59.987 214.561 59.1785 215.756 56.9146C217.018 54.5261 217.238 53.8657 217.297 52.2923C217.347 50.9592 216.841 49.2979 216.071 48.2637C215.122 46.9889 214.427 46.4404 212.267 45.26Z"
            fill="#CC554D"></path>
          <path
            d="M213.215 37.2109C214.625 37.802 217.655 39.4954 218.671 40.2592C221.586 42.4497 223.357 44.903 224.311 48.0697C224.742 49.4981 224.973 51.2576 224.909 52.6175C224.617 58.8535 220.359 65.5009 210.33 75.383C204.12 81.5018 194.206 90.0236 182.688 99.1443C173.467 106.446 167.223 110.275 161.741 111.99C155.579 113.918 150.089 113.411 144.906 110.437C141.195 108.308 138.508 105.73 135.51 101.424L134.579 100.087L132.967 100.485C129.206 101.415 128.524 101.559 127.449 101.659C125.559 101.835 123.659 101.497 121.805 100.658C117.214 98.5787 114.504 93.5806 115.276 88.6189C115.53 86.991 115.796 86.4065 119.414 79.5347L122.763 73.178L122.329 71.4377C121.021 66.1745 120.374 62.5503 119.898 57.8161C119.187 50.736 119.5 45.9112 120.943 41.7341C121.436 40.307 123.01 37.2474 123.776 36.2266C127.531 31.2241 132.887 28.5636 140.901 27.721C147.429 27.0346 154.975 27.3991 172.413 29.2418C192.332 31.3467 205.245 33.8687 213.215 37.2109ZM212.267 45.26C211.219 44.6875 209.983 44.0705 209.519 43.8879C201.038 40.5484 185.795 37.9865 161.251 35.7767C155.737 35.2801 153.214 35.12 149.67 35.0421C143.22 34.9002 139.635 35.2641 136.141 36.4138C133.389 37.3195 131.7 38.4619 130.087 40.5086C129.237 41.5871 128.172 43.8087 127.774 45.3334C126.878 48.7691 126.905 54.0117 127.855 60.5114C128.137 62.4468 128.775 65.8418 128.865 65.8888C128.9 65.9052 129.442 65.7561 130.071 65.5561C130.701 65.3555 133.441 64.5477 136.159 63.7619C149.834 59.8078 164.076 56.2685 178.09 53.3412C184.698 51.9609 192.046 50.5819 192.7 50.5993C193.268 50.6144 193.46 50.6751 194.239 51.0852C195.022 51.4981 195.176 51.6181 195.523 52.094C196.578 53.5425 196.497 55.5789 195.334 56.8641C194.482 57.8057 194.269 57.8767 189.586 58.7825C169.991 62.5727 154.272 66.3866 134.603 72.1222L130.607 73.2866L130.604 73.6583C130.598 74.5164 130.546 74.6289 126.632 82.1829C122.772 89.6335 122.76 89.6574 122.731 90.211C122.691 90.9825 123.068 92.0719 123.587 92.6837C123.921 93.0775 124.194 93.2804 124.855 93.63C126.15 94.3138 126.299 94.3013 131.226 93.0872C133.559 92.5123 135.701 92.0157 135.986 91.984C137.002 91.871 138.257 92.3133 138.998 93.0441C139.19 93.2327 139.711 93.971 140.157 94.6853C141.907 97.4877 143.749 99.8705 145.374 101.436C147.246 103.241 150.016 104.776 152.293 105.273C154.623 105.781 156.459 105.638 159.409 104.718C164.771 103.046 170.397 99.3606 182.249 89.7598C197.501 77.4042 206.555 69.0923 211.985 62.4603C214.011 59.987 214.561 59.1785 215.756 56.9146C217.018 54.5261 217.238 53.8657 217.297 52.2923C217.347 50.9592 216.841 49.2979 216.071 48.2637C215.122 46.9889 214.427 46.4404 212.267 45.26Z"
            stroke="#F1F5F9"></path>
        </svg>

        <div class="flex flex-col items-center gap-2">
          <!-- Success panel title -->
          <p
            class="text-n-700 font-secondary text-sm font-light md:text-lg lg:text-2xl"
          >
            We‚Äôre excited to begin this journey with you.
          </p>
          <p
            class="text-n-700 lg::w-[65%] w-[90%] text-center text-2xl leading-tight font-normal md:w-[75%] md:text-4xl lg:text-5xl lg:leading-[56px]"
          >
            At SAI International, your child is not just admitted, but truly
            welcomed.
          </p>
        </div>

        <!-- Success panel message -->
        <p
          class="text-n-600 font-secondary text-sm font-medium md:text-lg lg:text-2xl"
        >
          Our admissions team will be in touch with you shortly.
        </p>
      </article>

      <!-- SUBMITTING SCREEN -->
      <article
        id="submitting"
        class="bg-n-50 flex hidden flex-col items-center gap-6 py-16 text-center"
      >
        <div class="loader"></div>
        <p class="text-n-700 text-xl font-medium md:text-2xl">
          Submitting your form, please wait‚Ä¶
        </p>
      </article>
    </form>
  </div>
</section>

<style>
  .draw-svg {
    stroke-dasharray: 24;
    stroke-dashoffset: 15;
    animation: draw 1s ease-in-out forwards alternate infinite;
  }
  @keyframes draw {
    to {
      stroke-dashoffset: 0;
    }
  }

  /* Parent slide animation */
  .slide-parent {
    opacity: 0;
    transform: translateY(30px);
    animation: slideParent 0.45s ease-out forwards;
  }

  @keyframes slideParent {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Stagger children */
  .stagger > * {
    opacity: 0;
    transform: translateY(20px);
    animation: slideChild 0.5s ease-out forwards;
    &:nth-child(1) {
      opacity: 1;
      animation: float 6s ease-in-out infinite;
      will-change: transform;
    }
  }

  .stagger > *:nth-child(2) {
    animation-delay: 0.3s;
  }
  .stagger > *:nth-child(3) {
    animation-delay: 0.45s;
  }
  .stagger > *:nth-child(4) {
    animation-delay: 0.6s;
  }

  @keyframes slideChild {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Loader animation */
  .loader {
    width: 48px;
    height: 48px;
    border: 4px solid #e0e0e0;
    border-top-color: #c9443a;
    border-radius: 50%;
    animation: spin 0.9s linear infinite;
  }

  @keyframes float {
    0% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-16px);
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
</style>

<script>
  // ENUMS //
  import { EVENTS } from "@/enums/analytics.enum";

  // SCRIPTS //
  import { trackEvent, trackFormCompletionEvent } from "@/scripts/analytics";
  import { getDeviceType } from "@/scripts/device";

  // SERVICES //
  import { admissionEnquiryRequest } from "@/services/api/form.api.service";

  window.addEventListener("DOMContentLoaded", () => {
    const steps = [
      document.getElementById("step-1"),
      document.getElementById("step-2"),
      document.getElementById("step-3"),
    ];
    const thankYou = document.getElementById("thank-you");

    // Timing tracking
    let formStartTime = Date.now();
    let stepStartTime = Date.now();

    const showStep = (idx: number) => {
      steps.forEach((el, i) => el?.classList.toggle("hidden", i !== idx));
      thankYou?.classList.add("hidden");

      // Update step start time when switching steps
      stepStartTime = Date.now();

      // Track Step View
      const stepTitles = ["Student Info", "Parent Info", "Message"];
      trackEvent(`admission_form_step_${idx + 1}_viewed`, {
        step_number: idx + 1,
        step_title: stepTitles[idx],
        device_type: getDeviceType(),
        page_path: window.location.pathname,
      });
    };

    // Initially show step 1
    showStep(0);

    // ‚úÖ Validation
    const validateStep = (stepEl: any) => {
      // ... (validation logic remains same)
      if (!stepEl) return false;
      const fields = stepEl.querySelectorAll("input, select, textarea");
      let valid = true;

      console.log(fields, "heko");

      fields.forEach((el: any) => {
        const errorText = el
          .closest("[data-field]")
          ?.querySelector("[data-error]");
        let fieldValid = true;

        if (el.hasAttribute("required") && !el.value.trim()) fieldValid = false;

        console.log(fieldValid, "her");

        if (el.type === "email" && el.value.trim() !== "") {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(el.value.trim())) fieldValid = false;
        }

        // ‚ùå NAME VALIDATION: should NOT contain digits
        if (
          el.name === "parentName" ||
          (el.name === "name" && el.value !== "")
        ) {
          const hasDigits = /\d/.test(el.value);
          if (hasDigits) fieldValid = false;
        }

        // ‚ùå PHONE VALIDATION: should contain ONLY digits
        if (el.name === "mobileNo" && el.value !== "") {
          const notNumbers = /\D/.test(el.value);
          if (notNumbers || el.value.length !== 10) fieldValid = false;
        }

        console.log(fieldValid, "heko");

        if (!fieldValid) {
          valid = false;
          el.classList.add("border-red-500", "focus:ring-red-500");
          errorText?.classList.remove("hidden");
        } else {
          el.classList.remove("border-red-500", "focus:ring-red-500");
          errorText?.classList.add("hidden");
        }
      });

      return valid;
    };

    // ‚úÖ Step navigation
    document.getElementById("next-1")?.addEventListener("click", () => {
      if (validateStep(steps[0])) {
        console.log("heo");

        const duration = (Date.now() - stepStartTime) / 1000; // in seconds

        showStep(1);

        trackEvent(EVENTS.ADMISSION_FORM_NEXT_CLICKED, {
          device_type: getDeviceType(),
          from_step: 1,
          to_step: 2,
          time_spent_on_step: duration,
        });
      }
    });

    document.getElementById("next-2")?.addEventListener("click", (e) => {
      e.preventDefault();
      if (validateStep(steps[1])) {
        const duration = (Date.now() - stepStartTime) / 1000; // in seconds
        showStep(2);

        trackEvent(EVENTS.ADMISSION_FORM_NEXT_CLICKED, {
          device_type: getDeviceType(),
          from_step: 2,
          to_step: 3,
          time_spent_on_step: duration,
        });
      }
    });

    document
      .getElementById("back-2")
      ?.addEventListener("click", () => showStep(0));
    document
      .getElementById("back-3")
      ?.addEventListener("click", () => showStep(1));

    /** üî• Convert your form fields ‚Üí LeadSquared Attribute/Value array  */
    const mapToLeadSquared = (formObj: any) => {
      // Format date from YYYY-MM-DD to DD/MM/YYYY
      const formatDate = (dateStr: string) => {
        if (!dateStr) return "";
        const [year, month, day] = dateStr.split("-");
        return `${day}/${month}/${year}`;
      };

      return [
        { Attribute: "FirstName", Value: formObj.firstName || "" },
        { Attribute: "LastName", Value: formObj.lastName || "" },
        { Attribute: "EmailAddress", Value: formObj.emailId || "" },
        { Attribute: "Phone", Value: formObj.mobileNo || "" },
        { Attribute: "mx_DOB", Value: formatDate(formObj.dob) || "" },
        { Attribute: "mx_Grade", Value: formObj.className || "" },
        {
          Attribute: "mx_Parent_Name",
          Value: formObj.parentName || "",
        },
        {
          Attribute: "mx_Hostel_Facility",
          Value: formObj.hostel || "",
        },
        {
          Attribute: "mx_Current_School",
          Value: formObj.currentSchool || "",
        },
        { Attribute: "mx_City", Value: formObj.city || "" },
        { Attribute: "mx_Message", Value: formObj.message || "" },
        { Attribute: "mx_Source_V2", Value: "SIS Website Admission Page" },
      ];
    };

    // ‚úÖ Submit handler
    document.getElementById("submit")?.addEventListener("click", async (e) => {
      const prospectId = window.MXCProspectId || "";

      e.preventDefault();
      if (!validateStep(steps[2])) return;

      const totalDuration = (Date.now() - formStartTime) / 1000;

      // In hh:mm:ss format
      const formatDuration = (seconds: number) => {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const remainingSeconds = seconds % 60;
        return `${hours}:${minutes}:${remainingSeconds}`;
      };

      const form = document.querySelector("form") as HTMLFormElement;
      const formData = new FormData(form);
      const formObj = Object.fromEntries(formData.entries());

      // Convert to LeadSquared format
      const leadSquaredPayload = [
        ...mapToLeadSquared(formObj),
        {
          Attribute: "ProspectID",
          Value: prospectId,
        },
      ];

      const submitting = document.getElementById("submitting");

      // Hide steps, reset visibility
      steps.forEach((el) => el?.classList.add("hidden"));
      thankYou?.classList.add("hidden");

      // Remove old animation classes to re-trigger
      submitting?.classList.remove("slide-parent");
      submitting?.offsetHeight; // force reflow
      submitting?.classList.add("slide-parent");

      // Show submitting screen
      submitting?.classList.remove("hidden");

      try {
        const response = await admissionEnquiryRequest(leadSquaredPayload);

        // Check LSQ errors
        if (response.ExceptionMessage || response.Status !== "Success") {
          alert(
            "Something went wrong submitting your enquiry. Please try again.",
          );
          return;
        }

        // Track Form Completion
        trackFormCompletionEvent(
          {
            ...formObj,
            time_taken_for_submission: totalDuration,
            submission_time: formatDuration(totalDuration),
          },
          EVENTS.ADMISSION_FORM_COMPLETED,
        );

        // Hide loader & show thank you with stagger animation
        submitting?.classList.add("hidden");

        thankYou?.classList.remove("slide-parent");
        thankYou?.offsetHeight;
        thankYou?.classList.add("slide-parent");

        thankYou?.classList.remove("hidden");
      } catch (err) {
        submitting?.classList.add("hidden");
        console.error("‚ùå Failed to submit enquiry:", err);
        alert(
          "Something went wrong while submitting your enquiry. Please try again.",
        );
      }
    });
  });
</script>

<script>
  import { EVENTS } from "@/enums/analytics.enum";
  import {
    setupFormStartTracking,
    setupInViewTracking,
    trackFormViewEvent,
  } from "@/scripts/analytics";

  const form = document.querySelector(
    "form#admission-form",
  ) as HTMLFormElement | null;

  if (form) {
    setupFormStartTracking(form, EVENTS.ADMISSION_FORM_STARTED);
    // Track when form comes into view
    setupInViewTracking("admission-form", () => {
      trackFormViewEvent("admission-form", EVENTS.ADMISSION_FORM_VIEWED);
    });
  }
</script>
