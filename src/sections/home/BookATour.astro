---
import Image from "astro/components/Image.astro";
---

<section
  class="relative w-full xl:h-screen"
  data-name="book-a-tour-section"
  data-section="Book a Tour"
  id="book-a-tour"
>
  <!-- YouTube Video Background -->
  <div class="bg-n-950 absolute inset-0 h-full w-full">
    <Image
      id="video-fallback"
      src="/images/book-a-tour-fallback.jpg"
      alt="Campus tour"
      class="absolute inset-0 h-full w-full object-cover transition-opacity duration-500"
      loading="lazy"
      decoding="async"
      width={1200}
      height={680}
    />

    <div
      id="video-container"
      class="pointer-events-none absolute inset-0 h-full w-full"
    >
    </div>

    <!-- Dark overlay -->
    <div class="bg-n-950/30 absolute inset-0"></div>
  </div>

  <!-- Content -->
  <div
    class="relative z-10 container mx-auto flex h-full flex-col items-center justify-center gap-24 px-6 py-14 md:gap-80 md:py-24 lg:gap-90 lg:py-28 2xl:gap-96"
  >
    <!-- Title -->
    <p
      class="fade-in-down text-n-50 text-center text-3xl leading-[1.3] font-medium md:text-5xl lg:text-7xl"
    >
      Experience Education <br /> beyond the Classroom
    </p>

    <!-- CTA Button -->
    <div class="relative w-full">
      <a
        href="https://www.youtube.com/watch?v=uG206thPuaA"
        target="_blank"
        class="fade-in scale-in group text-n-950 font-secondary bg-n-50 hover:before:bg-n-900 hover:text-n-50 relative mx-auto flex w-fit items-center gap-3 overflow-hidden rounded-xl px-12 py-3.5 text-sm font-semibold transition-all duration-300 before:absolute before:inset-0 before:-z-10 before:origin-left before:scale-x-0 before:duration-300 before:ease-out before:content-[''] hover:before:scale-x-100 md:px-14 md:py-4 md:text-xl lg:px-32 lg:py-7 lg:text-2xl"
      >
        {"Take a tour"}
      </a>
    </div>
  </div>
</section>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    const section = document.getElementById("book-a-tour");
    const container = document.getElementById("video-container");
    const fallback = document.getElementById("video-fallback");

    if (!section || !container || !fallback) return;

    let loaded = false;

    const loadVideo = () => {
      if (loaded) return;
      loaded = true;

      const iframe = document.createElement("iframe");
      iframe.src =
        "https://www.youtube.com/embed/26RLzXfQu4s" +
        "?autoplay=1&mute=1&loop=1&playlist=26RLzXfQu4s" +
        "&controls=0&rel=0&modestbranding=1&playsinline=1";

      iframe.className = "absolute inset-0 h-full w-full object-cover";
      iframe.allow = "autoplay; encrypted-media";
      iframe.setAttribute("aria-hidden", "true");

      iframe.onload = () => {
        fallback.style.opacity = "0";
        setTimeout(() => fallback.remove(), 500);
      };

      container.appendChild(iframe);
    };

    // Safety fallback for very old browsers
    if (!("IntersectionObserver" in window)) {
      loadVideo();
      return;
    }

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          loadVideo();
          observer.disconnect();
        }
      },
      { rootMargin: "200px" },
    );

    observer.observe(section);
  });
</script>

<style>
  iframe {
    pointer-events: none;
  }
  .group:hover svg {
    transform: translateX(4px);
  }
</style>
