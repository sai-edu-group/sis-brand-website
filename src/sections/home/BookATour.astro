---
import Image from "astro/components/Image.astro";
---

<section
  class="relative w-full xl:h-screen"
  data-name="book-a-tour-section"
  data-section="Book a Tour"
>
  <!-- YouTube Video Background -->
  <div class="bg-n-950 absolute inset-0 h-full w-full">
    <Image
      id="video-fallback"
      src="/images/book-a-tour-fallback.png"
      alt="Campus tour"
      class="absolute inset-0 h-full w-full object-cover transition-opacity duration-500"
      loading="lazy"
      decoding="async"
      width={1200}
      height={680}
    />

    <iframe
      id="tour-video"
      src={`https://www.youtube.com/embed/26RLzXfQu4s?autoplay=1&loop=1&playlist=26RLzXfQu4s&mute=1&controls=0&disablekb=1&showinfo=0&rel=0&modestbranding=1&iv_load_policy=3&fs=0&cc_load_policy=0&enablejsapi=1`}
      class="pointer-events-none absolute inset-0 h-full w-full object-cover"
      allow="autoplay; encrypted-media"
      allowfullscreen
      frameborder="0"
      loading="lazy"
      title="School Tour Video"
    >
    </iframe>
    <!-- Dark overlay -->
    <div class="bg-n-950/30 absolute inset-0"></div>
  </div>

  <!-- Content -->
  <div
    class="relative z-10 container mx-auto flex h-full flex-col items-center justify-center gap-24 px-6 py-14 md:gap-80 md:py-24 lg:gap-90 lg:py-28 2xl:gap-96"
  >
    <!-- Title -->
    <p
      class="fade-in-down text-n-50 text-center text-3xl leading-[1.3] font-medium md:text-5xl lg:text-7xl"
    >
      Experience Education <br /> beyond the Classroom
    </p>

    <!-- CTA Button -->
    <div class="relative w-full">
      <a
        href="https://www.youtube.com/watch?v=uG206thPuaA"
        target="_blank"
        class="fade-in scale-in group text-n-950 font-secondary bg-n-50 hover:before:bg-n-900 hover:text-n-50 relative mx-auto flex w-fit items-center gap-3 overflow-hidden rounded-xl px-12 py-3.5 text-sm font-semibold transition-all duration-300 before:absolute before:inset-0 before:-z-10 before:origin-left before:scale-x-0 before:duration-300 before:ease-out before:content-[''] hover:before:scale-x-100 md:px-14 md:py-4 md:text-xl lg:px-32 lg:py-7 lg:text-2xl"
      >
        {"Take a tour"}
      </a>
    </div>
  </div>
</section>

<script is:inline>
  let player;
  const fallback = document.getElementById("video-fallback");

  function hideFallback() {
    if (!fallback) return;
    fallback.style.opacity = "0";
    // fully remove from hit-testing after fade
    fallback.style.display = "none";
  }

  // YouTube Iframe API callback
  window.onYouTubeIframeAPIReady = function () {
    player = new YT.Player("tour-video", {
      events: {
        onStateChange: (e) => {
          // ensure muted autoplay & hide fallback once ready
          if (e.data == 1) {
            try {
              e.target.mute();
              e.target.playVideo();
            } catch {}
          }
          hideFallback();
        },
        onError: hideFallback, // don't block UI if YT errors
      },
    });
  };

  // Load the Iframe API
  const tag = document.createElement("script");
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);

  // Play/Pause toggle
  // toggleBtn?.addEventListener("click", () => {
  //   if (!player) return;
  //   if (isPlaying) {
  //     player.pauseVideo();
  //     playIcon?.classList.remove("hidden");
  //     pauseIcon?.classList.add("hidden");
  //   } else {
  //     player.playVideo();
  //     playIcon?.classList.add("hidden");
  //     pauseIcon?.classList.remove("hidden");
  //   }
  //   isPlaying = !isPlaying;
  // });
</script>

<style>
  iframe {
    pointer-events: none;
  }
  .group:hover svg {
    transform: translateX(4px);
  }
</style>
