---
// COMPONENTS //
import { Icon } from "astro-icon/components";
import ActivityCard from "../../components/ActivityCard.astro";
import SectionHeaderMain from "../../components/SectionHeaderMain.astro";

// DATA //
import {
  sectionHeaderContent,
  flagshipContent,
} from "../../data/about/flagship";
---

<section class="bg-n-50 ns-slider relative w-full overflow-hidden">
  <div
    class="container mx-auto flex flex-col gap-10 px-6 py-14 md:gap-14 md:py-20 lg:gap-20 lg:py-28 2xl:px-0"
  >
    <!-- Section header title -->
    <SectionHeaderMain {...sectionHeaderContent} />

    <!-- Sai Seva Slider for Mobile and Tablet -->
    <!-- Slider root: keep viewport + controls inside this wrapper -->
    <div data-embla-root id={"flagship-slider"} class="space-y-7 md:space-y-9">
      <!-- Viewport -->
      <div class="overflow-hidden" data-embla-viewport>
        <!-- Container -->
        <div class="flex gap-9" data-embla-container>
          <!-- Sai Seva Slides -->
          {
            flagshipContent.map((flagshipItem) => (
              <div
                class="ns-slide card-anim card-bottom cursor-pointer"
                data-embla-slide
              >
                <ActivityCard
                  title={flagshipItem.title}
                  image={flagshipItem.image}
                  subTitle={flagshipItem.subTitle}
                  description={flagshipItem.description}
                />
              </div>
            ))
          }
        </div>
      </div>

      <!-- Controls + Dots -->
      <div
        class="relative flex items-center justify-center gap-8 md:gap-12 lg:gap-20"
      >
        <!-- Dots -->
        <div class="flex items-center gap-1.5 md:gap-2" data-embla-dots></div>

        <div class="absolute right-0 flex gap-4 md:gap-6">
          <!--  Prev button -->
          <button
            type="button"
            id="prevButton"
            class="bg-n-50 border-n-200 hover:bg-n-200 hidden size-9 cursor-pointer items-center justify-center rounded-full border p-1 md:size-14"
            data-embla-prev
            aria-label="Previous"
          >
            <span class="inline-flex">
              <Icon name="left-arrow" class="size-5 md:size-7" />
            </span>
          </button>

          <!-- Next button -->
          <button
            type="button"
            class="bg-n-50 border-n-200 hover:bg-n-200 hidden size-9 cursor-pointer items-center justify-center rounded-full border p-1 md:size-14"
            data-embla-next
            aria-label="Next"
          >
            <span class="inline-flex rotate-180">
              <Icon name="left-arrow" class="size-5 md:size-7" />
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Slider-level variables (like your tb-slider reference) */
  .ns-slider {
    --slides: 1; /* default: mobile shows 1 */
    --gap: 36px; /* match the gap-9 above */
    --peek: 0px; /* extra visible width to “peek” next slide */
  }

  @media (min-width: 640px) {
    .ns-slider {
      --slides: 2;
      --peek: 0px;
    }
  }

  /* Each slide width: ((100% - total gaps - peek) / slides) */
  .ns-slide {
    flex: 0 0
      calc(
        (100% - (var(--gap) * (var(--slides) - 1)) - var(--peek)) /
          var(--slides)
      );
  }
</style>

<!-- Component-level init: scoped to this slider only -->
<script type="module">
  // OTHERS //
  import { initEmblaRoot } from "/js/embla.js";

  window.addEventListener("DOMContentLoaded", () => {
    const root = document.getElementById("flagship-slider");
    initEmblaRoot(root, {
      align: "start",
      dragFree: false,
      slidesToScroll: "auto",
    });
  });
</script>
